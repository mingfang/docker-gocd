<h3><%= l.string('JOB_SETTINGS') %></h3>

<% form_for :job, @job,
                :url => admin_job_update_path(:current_tab => "settings"),
                :html => {:method => :put,
                          :id => "job_edit_form",
                          :onsubmit => "return AjaxForm.jquery_ajax_submit(this, AjaxForm.ConfigFormEditHandler);",
                          :class => "popup_form"} do |f| %>
    <%= md5_field %>
    <% scope = {:job => @job, :form => f, :cruise_config => @cruise_config}; -%><div class="fieldset">
    <div class="form_item required">
        <div class="form_item_block">
            <%= required_label(scope[:form], :name, l.string("JOB_NAME")) %>
            <div>
                <%= scope[:form].text_field :name %>
                <%= error_message_on(scope[:job], com.thoughtworks.cruise.config.JobConfig::NAME, :css_class => "form_error") %>
            </div>
        </div>
        <div class="form_item_block">
            <%= scope[:form].label com.thoughtworks.cruise.config.JobConfig::RESOURCES, l.string("RESOURCES") %>
            <div>
                <%= scope[:form].text_field com.thoughtworks.cruise.config.JobConfig::RESOURCES, :class => "resources_auto_complete", :value => scope[:job].resources().exportToCsv() %>
                <div class="contextual_help has_go_tip_right" title="<%= l.string("TOOLTIP_RESOURCES") -%>"></div>
                <%- scope[:job].resources().each do |resource| -%>
                    <%= error_message_on(resource, com.thoughtworks.cruise.config.JobConfig::RESOURCES, :css_class => "form_error") -%>
                <%- end -%>
            </div>
            <div class="inline_instruction">
                <%= l.string('INSTRUCTION_RESOURCES') -%>
            </div>
        </div>
        <div class="form_item">
            <%= scope[:form].label com.thoughtworks.cruise.config.JobConfig::TIMEOUT, l.string("JOB_TIMEOUT"), :class => "before_tip" %>
            <div class="contextual_help has_go_tip_right" title="<%=l.string("TOOLTIP_JOB_TIMEOUT")-%>"></div>
            <div class="clear"></div>

            <div class="checkbox_row">
                <%= scope[:form].radio_button 'timeoutType', com.thoughtworks.cruise.config.JobConfig::NEVER_TIMEOUT, :id => "jobTimeout_never" -%>
                <%= label_tag "jobTimeout_never", l.string("NEVER_TIMEOUT") -%>
            </div>
            
            <div class="checkbox_row">
                <%= scope[:form].radio_button 'timeoutType', com.thoughtworks.cruise.config.JobConfig::DEFAULT_TIMEOUT, :id => "jobTimeout_default" -%>
                <%= label_tag "jobTimeout_default", "#{l.string("DEFAULT_TIMEOUT")} (#{default_job_timeout_for_display(scope[:cruise_config])})"-%>
            </div>

            <div class="override_timeout checkbox_row">
                <%= scope[:form].radio_button 'timeoutType', com.thoughtworks.cruise.config.JobConfig::OVERRIDE_TIMEOUT, :id => "jobTimeout_override" -%>
                <%= label_tag "jobTimeout_override", l.string("OVERRIDE_TIMEOUT_PREFIX")  -%>
                <%= scope[:form].text_field com.thoughtworks.cruise.config.JobConfig::TIMEOUT, :class => "inline in_between_text small_text_field" %>
                <%= label_tag "jobTimeout_override", l.string("OVERRIDE_TIMEOUT_SUFFIX") -%>
            </div>
        </div>
        <div class="form_item_block checkbox_row run_on_all_agents">
            <%= scope[:form].check_box :runOnAllAgents, :title => "#{l.string("TOOLTIP_RUN_ON_ALL")}" %>
            <label for="job_runOnAllAgents" title="<%= l.string("TOOLTIP_RUN_ON_ALL") %>"><%= l.string('RUN_ON_ALL_AGENTS') -%></label>
            <%= error_message_on(scope[:job].isRunOnAllAgents(), "type", :css_class => "form_error") %>
        </div>
    </div>
    <% _scope = {}; -%><p class="required">
	<span class="asterisk"><%= l.string("REQUIRED_FIELD")%></span><%= l.string("REQUIRED_FIELD_MESSAGE")-%>
</p>
    <% _scope = {}; -%><script type="text/javascript">
    Util.on_load(function() {
        jQuery(".has_go_tip").tipTip({activation: "click", maxWidth: "auto", edgeOffset: 10});
        jQuery(".has_go_tip_right").tipTip({activation: "click", maxWidth: "auto", edgeOffset: 10, defaultPosition: "right"});
        jQuery(".has_go_tip_left").tipTip({activation: "click", maxWidth: "auto", edgeOffset: 10, defaultPosition: "left" });
        jQuery(".has_go_tip_top").tipTip({activation: "click", maxWidth: "auto", edgeOffset: 10, defaultPosition: "top" });
    });
</script>
</div>
<script type="text/javascript">

    Util.on_load(function() {
        function hookupResourcesAutoComplete() {
            jQuery(".resources_auto_complete").autocomplete(<%= @autocomplete_resources -%>, {
                multiple: true,
                minChars: 0,
                matchContains: true,
                selectFirst: false,
                multipleSeparator: ", ",
                width: 248});
        };
        
        hookupResourcesAutoComplete();

    });
</script>
    <% scope = {:reset_url => admin_job_edit_path(:pipeline_name => @pipeline.name(), :stage_name => params[:stage_name], :job_name => params[:job_name], :current_tab => "settings")}; -%><div class="form_buttons">
    <%= submit_button(l.string("SAVE"), :class => 'primary skip_dirty_stop') %>
    <%= link_to  l.string("RESET"), scope[:reset_url], :class => 'reset_button link_as_button skip_dirty_stop', :id => 'reset_form' -%>
</div>
<% end %>
<script type="text/javascript">
   AjaxForm.error_box_selector = '#form_parent';
</script>