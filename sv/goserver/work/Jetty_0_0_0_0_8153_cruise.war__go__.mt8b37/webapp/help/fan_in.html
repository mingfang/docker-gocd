
<!doctype html>

<html xmlns = 'http://www.w3.org/1999/xhtml' xml:lang = 'en' lang = 'en'>
<head>
<meta http-equiv = 'Content-Type' content = 'text/html; charset=UTF-8'></meta>

<meta name = 'google-site-verification' content = 'ALfMTxdH04YK-7c9mgrjLTkrOP55XqZtXqFk1dqCB4M'></meta>

<title>Fan-in Dependency Management</title>

<link href = 'resources/stylesheets/help.css' media = 'screen' rel = 'Stylesheet' type = 'text/css'></link>

<link href = '//assets.zendesk.com/external/zenbox/v2.5/zenbox.css' media = 'screen, projection' rel = 'Stylesheet' type = 'text/css'></link>

<link href = 'resources/stylesheets/help_search.css' media = 'screen' rel = 'Stylesheet' type = 'text/css'></link>

<script src = '//www.google.com/jsapi' type = 'text/javascript'></script>

<link href = '/go/images/cruise.ico' rel = 'shortcut icon'></link>

<script src = 'resources/javascript/prototype.js' type = 'text/javascript'></script>

<script src = '//assets.zendesk.com/external/zenbox/v2.5/zenbox.js' type = 'text/javascript'></script>

<script src = 'resources/javascript/help.js' type = 'text/javascript'></script>

<script src = 'resources/javascript/help_search.js' type = 'text/javascript'></script>
</head>

<body>
<div id = 'hd'>
<h1>Help documentation
<div id = 'go_help_search'></div>
</h1>
</div>

<div class = 'block-content'>
            <script type="text/javascript">
               if (typeof(Zenbox) !== "undefined") {
                  Zenbox.init({
                    dropboxID:   "20094116",
                    url:         "http://twstudios.zendesk.com",
                    tabID:       "Help",
                    tabColor:    "black",
                    tabPosition: "Right"
                  });
             }
            </script>
          </div>

<div id = 'main-container'>
<div id = 'search_results_container'>
<div class = 'action-bar' inner_wrapper_class = 'action-bar-inner-wrapper'>
<div class = 'action-bar-inner-wrapper'>
<a id = 'hide_search_results'>&nbsp;</a>
</div>
</div>

<div id = 'branding'></div>

<div id = 'search_results'></div>
</div>

<div id = 'main'>
<div class = 'chapter'>
<h1 onclick = 'toggleCollapse($(this));' class = 'collapsible-heading'>Fan-in Dependency Management</h1>

<div class = 'content-container'>
<p>  Go supports fan-in dependency resolution for pipelines that are on auto trigger. 
  Fan-in material resolution will ensure that a pipeline triggers only when all its upstream pipelines have triggered off the same version of an ancestor pipeline or material. This will be the case when you have multiple components building in separate pipelines which all have the same ancestor and you want downstream pipelines to all use the same version of the artifact from the ancestor pipeline.</p>

<p>When you have non trivial pipeline dependency graphs, significant differences in pipeline execution times and automatic builds/deployments, you may typically run into the following issues</p>

<ul>
<li>
<strong>Wasted builds</strong>
 : Premature runs which do not have the right version of dependent components because one of the dependent pipelines was faster than the rest.</li>

<li>
<strong>Inconsistent results</strong>
 : Your deployment that depends on multiple components may have incompatible versions of components because the build times of these components are different</li>

<li>
<strong>Incorrect feedback </strong>
: Your deployment to Production should happen only when it has successfully passed the UAT, Staging and Pre-Prod environments but it was triggered prematurely as soon as UAT went green.</li>

<li>
<strong>Running code with the wrong tests</strong>
 : Your commit to SCM contains both code and tests written for the code. Your pipelines are modeled such that your acceptance or test pipeline runs after the build pipeline. Acceptance has to run with the right tests for the code but instead it triggers as soon as the commit goes through with the previous available version for tests.</li>
</ul>

<p>Go helps solve all of the above problems</p>

<p>
<strong>How to use fan-in</strong>
:</p>

<ul>
<li>In cases where your SCM material is used throughout the process you will need to define the same URL for the material throughout. This will let Go know that it is a shared material and Go will enforce fan-in wherever applicable.
    For example: code, tests, environment configuration are in http://svn.company.com/code, http://svn.company.com/tests, and http://svn.company.com/config respectively. In this case ensure for pipelines that need these materials, the url is set to the same value. For example the pipelines Build, Acceptance and Deploy have the material url http://svn.company.com</li>

<li>Pipelines where fan-in dependency resolution is required will need to have trigger type set as auto</li>
</ul>

<div class = 'section'>
<h3 onclick = 'toggleCollapse($(this));' class = 'collapsible-heading'>Example use cases for fan-in resolution</h3>

<div class = 'content-container'>
<div class = 'subsection'>
<h4 onclick = 'toggleCollapse($(this));' class = 'collapsed-heading'>Creating a gate to production</h4>

<div class = 'content-container collapsed'>
<p>I want to push a build into a number of environments in parallel (Manual QA, UAT for business sign off and performance testing) so that all these activities happen at the same time. 
  So we have a pipeline dependency model as shown below</p>

<img src = 'resources/images/cruise/fanin_1_1.png'></img>

<p>For the next step, when deploying to production, we have a pipeline that depends on all 3 of the above pipeline so that a build that has succeeded in all 3 environments is automatically pushed to production. This is shown below.</p>

<img src = 'resources/images/cruise/fanin_1_2.png'></img>

<p>Sequence of Events and Resolution</p>

<ul>
<li>A new build is generated.</li>

<li>The build is pushed to QA, UAT and performance pipelines.</li>

<li>Regardless of the time taken in each of these pipelines, Go will ensure that production is triggered only after all three pipelines go green with the same version of build. Production will use the right version of your build artifacts.</li>
</ul>

<p>  How to configure:</p>

<ul>
<li>Production should have trigger type as auto.</li>

<li>QA, UAT and Performance should have Build as a material. Trigger type for these pipelines can be either manual or auto.</li>

      <div class="note-box" style="padding: 0px 0pt 0pt">
    	  <div class="ab-bg">
      		<span class="ab-corner lvl1"></span>
      		<span class="ab-corner lvl2"></span>
      		<span class="ab-corner lvl3"></span>
      		<span class="ab-corner lvl4"></span>
      	</div>
      	<div class="box-content">
    
<p class = 'box'>To fetch artifacts from build into the deployment pipeline, you can use <a href = 'managing_dependencies.html#fetch_artifact_section'>fetch ancestor artifacts</a>.</p>
	
        </div>
    	  <div class="ab-bg">
      		<span class="ab-corner lvl4"></span>
      		<span class="ab-corner lvl3"></span>
      		<span class="ab-corner lvl2"></span>
      		<span class="ab-corner lvl1"></span>
      	</div>
      </div>
    </ul>
</div>
</div>

<div class = 'subsection'>
<h4 onclick = 'toggleCollapse($(this));' class = 'collapsed-heading'>Picking the right version of dependent components</h4>

<div class = 'content-container collapsed'>
<p>I have three component pipelines (C1, C2, C3) and a package pipeline that fetches their artifacts and creates a deploy package. Components C2 and C3 depend on pipeline C1 and have it as a material. The pipeline for C2 builds quickly but C3 takes a while. 
  So we have a pipeline dependency model as shown below</p>

<img src = 'resources/images/cruise/fanin_2_1.png'></img>

<p>The package pipeline should not trigger as soon as C2 is done. It should trigger only if both C2 and C3 go green. Additionally Package should use the same version of C1 that was used by C2 and C3. </p>

<p>Sequence of Events and Resolution</p>

<ul>
<li>C1 is triggered on a change.</li>

<li>C2 and C3 are triggered after C1 is successful.</li>

<li>C2 builds quickly but C3 is still in Progress.</li>

<li>Go resolves that C3 and C2 depend on a common ancestor C1. Hence Go will wait for C3 to finish.</li>

<li>If C3 goes green, the Package pipeline will trigger. It will use the right versions of C1, C2 and C3.</li>
</ul>

<p>  How to configure:</p>

<ul>
<li>Add C1 as a material for pipelines C2 and C3</li>

<li>Add C2 and C3 as materials for pipeline Package.</li>

<li>Package should have trigger type as auto</li>

      <div class="note-box" style="padding: 0px 0pt 0pt">
    	  <div class="ab-bg">
      		<span class="ab-corner lvl1"></span>
      		<span class="ab-corner lvl2"></span>
      		<span class="ab-corner lvl3"></span>
      		<span class="ab-corner lvl4"></span>
      	</div>
      	<div class="box-content">
    
<p class = 'box'>In the pipeline package, you can fetch artifacts from C2,C3 and ancestor C1. See <a href = 'managing_dependencies.html#fetch_artifact_section'>fetch ancestor artifacts.</a></p>
	
        </div>
    	  <div class="ab-bg">
      		<span class="ab-corner lvl4"></span>
      		<span class="ab-corner lvl3"></span>
      		<span class="ab-corner lvl2"></span>
      		<span class="ab-corner lvl1"></span>
      	</div>
      </div>
    </ul>
</div>
</div>

<div class = 'subsection'>
<h4 onclick = 'toggleCollapse($(this));' class = 'collapsed-heading'>Test source code with the right version of tests</h4>

<div class = 'content-container collapsed'>
<p>You check-in code and tests as part of the same commit.  The build pipeline compiles code and creates an artifact. The Acceptance pipeline fetches the build artifact and runs the tests that were written for the compiled code. Acceptance has to use the same tests committed with the code.
  So we have a pipeline dependency model as shown below</p>

<img src = 'resources/images/cruise/fanin_3_1.png'></img>

<p>Sequence of Events and Resolution</p>

<ul>
<li>On committing the changes, the Build pipeline will trigger with the latest revision.</li>

<li>Although Acceptance also has the same material dependency, Go will not trigger it immediately.</li>

<li>Build pipeline executes successfully.</li>

<li>Acceptance will now trigger with the same version of the SCM and fetch the right build artifact from the Build pipeline.</li>
</ul>

<p>  How to configure:</p>

<ul>
<li>Add the same SCM material to pipelines Build and Acceptance i.e the same URL.</li>

<li>Pipelines Build and Acceptance have trigger type as auto.</li>
</ul>
</div>
</div>
</div>
</div>

<div class = 'section'>
<h3 onclick = 'toggleCollapse($(this));' class = 'collapsible-heading'>Limitations</h3>

<div class = 'content-container'>
<ul>
<li>
<strong>Fan-in and blacklist</strong>
: If the pipelines contributing to the fan-in have blacklist in their material definitions, the target pipeline does not adhere to fan-in behavior. 
    
<img src = 'resources/images/ignored_files.png'></img>

<p>For example, refer to the scenario above.  P1 and P2 are two pipelines which use the same mercurial (hg) repository, with two folders say "p1" and "p2".  P1 is configured with "p2" folder in the blacklist.  Likewise P2 is configured with "p1" folder in the blacklist.</p>

<p>The first run of P1 happens when a check-in happens in "p1" folder.  The first run of P2 happens when there is a check-in to "p2".  </p>

<p>In this scenario, P3, which is dependant on P1 and P2 does not trigger.</p>
</li>
</ul>
</div>
</div>

<div class = 'section'>
<h3 onclick = 'toggleCollapse($(this));' class = 'collapsible-heading'>Notes</h3>

<div class = 'content-container'>
<ul>
<li>Fan-in as a feature is enabled by default. In case you need pipelines to trigger with every version regardless of ancestor versions you can disable fan-in. To disable fan-in you will need to add a system property and restart the Go server. On linux add the following line to /etc/default/go-server
      
<pre class = 'code'>export GO_SERVER_SYSTEM_PROPERTIES='-Dresolve.fanin.revisions=N'</pre>

      On windows, in the config folder of the Go server installation, edit the wrapper-server.conf file, and add an additional property with the value '-Dresolve.fanin.revisions=N'. For example:
      
<pre class = 'code'>wrapper.java.additional.17='-Dresolve.fanin.revisions=N'</pre>
</li>

<li>Go will apply fan-in dependency resolution for pipelines that have auto trigger type only.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div id = 'no_result_message' class = 'error-box' style = 'display:none;'>
<div class = 'box-content'>
<div class = 'box'>Your search 
<span class = 'search_term'></span>
did not match any help pages.</div>
</div>
</div>

<div id = 'nav'>
<ul class = 'toc'>
<li>
<a href = 'welcome_to_go.html' class = 'current'>Welcome to Go</a>

<ul>
<li>
<a href = 'whats_new_in_go.html'>What's new in Go</a>
</li>

<li>
<a href = 'concepts_in_go.html'>Concepts in Go</a>
</li>
</ul>
</li>

<li>
<div>Installing Go</div>

<ul>
<li>
<a href = 'system_requirements.html'>System requirements</a>
</li>

<li>
<a href = 'installing_go_server.html'>Installing Go server</a>
</li>

<li>
<a href = 'installing_go_agent.html'>Installing Go agent</a>
</li>

<li>
<a href = 'run_go_without_install.html'>Running Go without installation</a>
</li>

<li>
<a href = 'upgrading_go.html'>Upgrading Go</a>
</li>

<li>
<a href = 'configuring_server_details.html'>Configuring server details</a>
</li>

<li>
<a href = 'configure_proxy.html'>Configure a Proxy</a>
</li>

<li>
<a href = 'performance_tuning.html'>Performance Tuning</a>
</li>
</ul>
</li>

<li>
<div>Using Go</div>

<ul>
<li>
<a href = 'quick_pipeline_setup.html'>Setup a new pipeline</a>
</li>

<li>
<a href = 'managing_pipelines.html'>Managing pipelines</a>
</li>

<li>
<a href = 'managing_a_build_cloud.html'>Managing agents</a>
</li>

<li>
<a href = 'managing_artifacts_and_reports.html'>Managing artifacts and reports</a>
</li>

<li>
<a href = 'managing_dependencies.html'>Managing dependencies</a>
</li>

<li>
<a href = 'managing_environments.html'>Managing environments</a>
</li>

<li>
<a href = 'dev_authentication.html'>Setting up authentication</a>
</li>

<li>
<a href = 'managing_users.html'>Managing Users</a>
</li>

<li>
<a href = 'dev_notifications.html'>Notifications</a>
</li>

<li>
<a href = 'properties.html'>Properties</a>
</li>

<li>
<a href = 'build_labelling.html'>Pipeline Labelling</a>
</li>

<li>
<a href = 'compare_pipelines.html'>Compare Builds</a>
</li>

<li>
<a href = 'go_integration.html'>Integration with external tools</a>
</li>

<li>
<a href = 'ordering_of_pipelines.html'>Ordering of pipelines</a>
</li>

<li>
<a href = 'pipeline_scheduling.html'>Pipeline Scheduling</a>
</li>

<li>
<a href = 'gadgets.html'>Gadgets</a>
</li>

<li>
<a href = 'delete_artifacts.html'>Auto delete artifacts</a>
</li>

<li>
<a href = 'job_timeout.html'>Job Timeout</a>
</li>

<li>
<a href = 'stage_duration_chart.html'>Graphs</a>
</li>

<li>
<a href = 'stage_old_config.html'>Historical Configuration</a>
</li>

<li>
<a href = 'command_repository.html'>Command Repository</a>
</li>

<li>
<a href = 'concurrent_config_modifications.html'>Concurrent Modifications to Go's Configuration</a>
</li>

<li>
<a href = 'package_material.html'>Package Material</a>
</li>

<li>
<a href = 'plugin_user_guide.html'>Plugin User Guide</a>
</li>
</ul>
</li>

<li>
<div>Go Tour</div>

<ul>
<li>
<a href = 'Pipelines_Dashboard_page.html'>Pipelines Dashboard</a>
</li>

<li>
<a href = 'agents_page.html'>Agents</a>
</li>

<li>
<a href = 'pipeline_activity_page.html'>Pipeline Activity</a>
</li>

<li>
<a href = 'stage_details_page.html'>Stage Details</a>
</li>

<li>
<a href = 'job_details_page.html'>Job Details</a>
</li>

<li>
<a href = 'administration_page.html'>Administration</a>
</li>

<li>
<a href = 'server_details_page.html'>Server Details</a>
</li>

<li>
<a href = 'environments_page.html'>Environments</a>
</li>

<li>
<a href = 'value_stream_map.html'>Value Stream Map</a>
</li>
</ul>
</li>

<li>
<div>As a Developer, I want to...</div>

<ul>
<li>
<a href = 'Pipelines_Dashboard_page.html'>...watch what's currently building</a>
</li>

<li>
<a href = 'trigger_with_options.html'>...trigger a pipeline with a different revision of material</a>
</li>

<li>
<a href = 'dev_notifications.html'>...be notified when I break the build</a>
</li>

<li>
<a href = 'dev_understand_why_build_broken.html'>...understand why the build is broken</a>
</li>

<li>
<a href = 'dev_see_artifact_as_tab.html'>...see my artifacts as a sub-tab on the Job Details page</a>
</li>

<li>
<a href = 'dev_save_properties.html'>...save properties about a build</a>
</li>

<li>
<a href = 'dev_clean_up_when_cancel.html'>...clean up my environment when I cancel a task</a>
</li>

<li>
<a href = 'dev_conditional_task_execution.html'>...only run a task when the build has failed</a>
</li>

<li>
<a href = 'dev_use_current_revision_in_build.html#current'>...use the current revision in my build</a>
</li>
</ul>
</li>

<li>
<div>As a Tester, I want to...</div>

<ul>
<li>
<a href = 'rm_deploy_to_environment.html#deploy_uat'>...release something into my UAT environment</a>
</li>

<li>
<a href = 'tester_what_has_changed.html'>...know what has changed in my new binary</a>
</li>

<li>
<a href = 'dependency_management.html'>...ensure appropriate tests are run against new builds</a>
</li>
</ul>
</li>

<li>
<div>As a Release Manager, I want to...</div>

<ul>
<li>
<a href = 'rm_deploy_to_environment.html#deploy_prod'>...release something into production</a>
</li>

<li>
<a href = 'rm_what_is_deployed.html'>...know what's currently in production</a>
</li>

<li>
<a href = 'deploy_a_specific_build_to_an_environment.html'>...deploy a specific build to production</a>
</li>

<li>
<a href = 'managing_environments.html'>...manage my environments</a>
</li>
</ul>
</li>

<li>
<div>As a Go Administrator, I want to...</div>

<ul>
<li>
<a href = 'pipeline_templates.html'>...template my pipelines</a>
</li>

<li>
<a href = 'admin_use_parameters_in_configuration.html'>...parameterize my pipelines</a>
</li>

<li>
<a href = 'installing_go_agent.html'>...install a new agent</a>
</li>

<li>
<a href = 'agent_auto_register.html'>...auto register a remote agent</a>
</li>

<li>
<a href = 'agent_guid_issue.html'>...clone/copy existing agents</a>
</li>

<li>
<a href = 'admin_install_multiple_agents.html'>...install multiple agents on one machine</a>
</li>

<li>
<a href = 'agents_page.html#filter_agents'>...view and filter agents</a>
</li>

<li>
<a href = 'quick_pipeline_setup.html'>...add a new pipeline</a>
</li>

<li>
<a href = 'admin_add_material.html'>...add a new  material to an existing pipeline</a>
</li>

<li>
<a href = 'admin_add_stage.html'>...add a new stage to an existing pipeline</a>
</li>

<li>
<a href = 'admin_add_job.html'>...add a new job to an existing stage</a>
</li>

<li>
<a href = 'admin_run_on_all_agents.html'>...run the same job on a group of agents</a>
</li>

<li>
<a href = 'dev_use_current_revision_in_build.html#job'>...pass environment variables to jobs</a>
</li>

<li>
<a href = 'admin_lock_pipelines.html'>...ensure only one instance of a pipeline can run at the same time</a>
</li>

<li>
<a href = 'dev_choose_when_stage_runs.html'>...choose when a certain stage runs</a>
</li>

<li>
<a href = 'admin_use_custom_pipeline_label.html'>...use a custom pipeline label</a>
</li>

<li>
<a href = 'managing_dependencies.html'>...manage my dependent pipelines</a>
</li>

<li>
<a href = 'dev_authentication.html'>...enable authentication on my Go server</a>
</li>

<li>
<a href = 'dev_authentication.html#ldap_authentication'>..configure LDAP access for my Go server</a>
</li>

<li>
<a href = 'dev_authorization.html'>...change permissions for different actions</a>
</li>

<li>
<a href = 'dev_authorization.html#pipeline-groups'>...ensure only certain users can see a group of pipelines</a>
</li>

<li>
<a href = 'dev_upload_test_report.html'>...publish reports and artifacts</a>
</li>

<li>
<a href = 'ui_testing.html'>...configure an agent to run UI tests</a>
</li>

<li>
<a href = 'admin_mailhost_info.html'>...add mailhost information to support email notifications</a>
</li>

<li>
<a href = 'admin_out_of_disk_space.html'>...clean up old artifacts when running out of disk space</a>
</li>

<li>
<a href = 'admin_timer.html'>...run a pipeline on a schedule</a>
</li>

<li>
<a href = 'managing_a_build_cloud.html#pausing_agent'>...pause an agent</a>
</li>

<li>
<a href = 'agent_details.html#identifying_environment_issues'>...see if a job fails because of an environment issue</a>
</li>

<li>
<a href = 'delegating_group_administration.html'>...delegating group administration</a>
</li>

<li>
<a href = 'one_click_backup.html'>...backup Go server</a>
</li>

<li>
<a href = 'material_update_hung.html'>...be notified when Go server is not able to poll for changes</a>
</li>
</ul>
</li>

<li>
<div>Mingle Integration</div>

<ul>
<li>
<a href = 'mingle_in_go.html'>Displaying Mingle gadgets in Go</a>
</li>

<li>
<a href = 'mingle_card_activity_gadget.html'>Mingle Card Activity Gadget</a>
</li>
</ul>
</li>

<li>
<a href = 'http://support.thoughtworks.com/categories/20002778-go-community-support'>FAQ/Troubleshooting</a>
</li>

<li>
<a href = 'go_api.html'>Go API</a>

<ul>
<li>
<a href = 'Artifacts_API.html'>Artifacts API</a>
</li>

<li>
<a href = 'Properties_API.html'>Properties API</a>
</li>

<li>
<a href = 'Configuration_API.html'>Configuration API</a>
</li>

<li>
<a href = 'Pipeline_API.html'>Pipeline API</a>
</li>

<li>
<a href = 'Stages_API.html'>Stages API</a>
</li>

<li>
<a href = 'command_repo_api.html'>Command Repo API</a>
</li>

<li>
<a href = 'Agent_API.html'>Agent API</a>
</li>

<li>
<a href = 'Feeds_API.html'>Feeds API</a>
</li>

<li>
<a href = 'Backup_API.html'>Backup API</a>
</li>

<li>
<a href = 'materials_api.html'>Materials API</a>
</li>

<li>
<a href = 'users_api.html'>Users API</a>
</li>
</ul>
</li>

<li>
<div>Extension Points of Go</div>

<ul>
<li>
<a href = 'go_plugins_basics.html'>Plugins in Go</a>
</li>

<li>
<a href = 'resources/javadoc/index.html' target = '_blank'>Go Plugin API</a>
</li>

<li>
<a href = 'writing_go_package_material_plugin.html'>Writing a package material plugin</a>
</li>
</ul>
</li>

<li>
<div>Bundled Plugins</div>

<ul>
<li>
<a href = 'yum_repository_poller.html'>Yum Repository Poller</a>
</li>
</ul>
</li>

<li>
<div>Configuration</div>

<ul>
<li>
<a href = 'configuration_reference.html'>Configuration Reference</a>
</li>

<li>
<a href = 'schema.html'>Schema</a>
</li>
</ul>
</li>
</ul>
</div>

<div id = 'ft' class = 'footer'>&copy; ThoughtWorks Studios, 2010</div>
</body>
</html>
