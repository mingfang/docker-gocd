
<!doctype html>

<html xmlns = 'http://www.w3.org/1999/xhtml' xml:lang = 'en' lang = 'en'>
<head>
<meta http-equiv = 'Content-Type' content = 'text/html; charset=UTF-8'></meta>

<meta name = 'google-site-verification' content = 'ALfMTxdH04YK-7c9mgrjLTkrOP55XqZtXqFk1dqCB4M'></meta>

<title>Writing a package material plugin</title>

<link href = 'resources/stylesheets/help.css' media = 'screen' rel = 'Stylesheet' type = 'text/css'></link>

<link href = '//assets.zendesk.com/external/zenbox/v2.5/zenbox.css' media = 'screen, projection' rel = 'Stylesheet' type = 'text/css'></link>

<link href = 'resources/stylesheets/help_search.css' media = 'screen' rel = 'Stylesheet' type = 'text/css'></link>

<script src = '//www.google.com/jsapi' type = 'text/javascript'></script>

<link href = '/go/images/cruise.ico' rel = 'shortcut icon'></link>

<script src = 'resources/javascript/prototype.js' type = 'text/javascript'></script>

<script src = '//assets.zendesk.com/external/zenbox/v2.5/zenbox.js' type = 'text/javascript'></script>

<script src = 'resources/javascript/help.js' type = 'text/javascript'></script>

<script src = 'resources/javascript/help_search.js' type = 'text/javascript'></script>
</head>

<body>
<div id = 'hd'>
<h1>Help documentation
<div id = 'go_help_search'></div>
</h1>
</div>

<div class = 'block-content'>
            <script type="text/javascript">
               if (typeof(Zenbox) !== "undefined") {
                  Zenbox.init({
                    dropboxID:   "20094116",
                    url:         "http://twstudios.zendesk.com",
                    tabID:       "Help",
                    tabColor:    "black",
                    tabPosition: "Right"
                  });
             }
            </script>
          </div>

<div id = 'main-container'>
<div id = 'search_results_container'>
<div class = 'action-bar' inner_wrapper_class = 'action-bar-inner-wrapper'>
<div class = 'action-bar-inner-wrapper'>
<a id = 'hide_search_results'>&nbsp;</a>
</div>
</div>

<div id = 'branding'></div>

<div id = 'search_results'></div>
</div>

<div id = 'main'>
<div class = 'chapter'>
<h1 onclick = 'toggleCollapse($(this));' class = 'collapsible-heading'>Writing a package material plugin</h1>

<div class = 'content-container'>
<div class = 'section'>
<h3 onclick = 'toggleCollapse($(this));' class = 'collapsible-heading'>Introduction</h3>

<div class = 'content-container'>
<p>
            A package repository typically holds a set of packages, each of which can have multiple versions. Package repository material allows Go to trigger a pipeline(s) when a newer version of a
            package is published. Go bundles <a href = 'yum_repository_poller.html'>yum-repo-poller plugin</a> by default, this plugin can communicate with a yum repository. The following sections talk about how to write
            a plugin which can communicate with other type of repositories.
        </p>

<p>
            The starting point for the plugin author while writing <a href = 'package_material.html'>package material</a> plugin is to implement the PackageMaterialProvider interface.
            The implementation of PackageMaterialProvider interface is responsible for providing a configuration provider (say SampleRepositoryConfiguration) and a repository poller (say SampleRepositoryPoller)
            for the package.
        </p>

<pre class = 'code'>
    public class SamplePackageRepoMaterial implements PackageMaterialProvider {
        public SampleRepositoryConfiguration getConfig() {
            return new SampleRepositoryConfiguration();
        }

        public SampleRepositoryPoller getPoller() {
            return new SampleRepositoryPoller();
        }
    }
        </pre>

<p>
            Here SampleRepositoryConfiguration is the configuration provider and is responsible for dictating what configurations should be captured
            by Go to communicate with the package repository.
        </p>

<pre class = 'code'>
    public class SampleRepositoryConfiguration implements PackageMaterialConfiguration {
        public RepositoryConfiguration getRepositoryConfiguration() {
            ...
        }

        public PackageConfiguration getPackageConfiguration() {
            ...
        }

        public ValidationResult isRepositoryConfigurationValid(RepositoryConfiguration repositoryConfiguration) {
            ...
        }

        public ValidationResult isPackageConfigurationValid(PackageConfiguration packageConfiguration, RepositoryConfiguration repositoryConfiguration) {
            ...
        }
    }
        </pre>

<p>
            For a given configuration, repository poller, in this case SamplePackageMaterialPoller, should communicate with the package repository to fetch the latest package.
        </p>

<pre class = 'code'>
    public class SamplePackageMaterialPoller implements PackageMaterialPoller {
        public PackageRevision getLatestRevision(PackageConfiguration packageConfiguration, RepositoryConfiguration repositoryConfiguration) {
            ...
        }

        public PackageRevision latestModificationSince(PackageConfiguration packageConfiguration, RepositoryConfiguration repositoryConfiguration, PackageRevision packageRevision) {
            ...
        }

        public Result checkConnectionToRepository(RepositoryConfiguration repositoryConfiguration) {
            ...
        }

        public Result checkConnectionToPackage(PackageConfiguration packageConfiguration, RepositoryConfiguration repositoryConfiguration) {
            ...
        }
    }
        </pre>
</div>
</div>

<div class = 'section'>
<h3 onclick = 'toggleCollapse($(this));' class = 'collapsible-heading'>Configuration Provider</h3>

<div class = 'content-container'>
<p> The configuration provider should implement PackageMaterialConfiguration interface. Go will communicate with the implementation of PackageMaterialConfiguration to know what configuration should be captured,
            so that the PackageMaterialPoller can later use this information to get latest package details. PackageMaterialConfiguration is also expected to validate configurations. Every configuration type
            (Example : RepositoryConfiguration and  PackageConfiguration) will have a set properties. Each <a href = 'resources/javadoc/com/thoughtworks/go/plugin/api/material/packagerepository/Property.html' target = 'resources/javadoc/com/thoughtworks/go/plugin/api/material/packagerepository/Property.html'>property</a> has a key, value and a list of options. Options are a way to define metadata for the property,
            For example: Display name of the property can be set using the Property.DISPLAY_NAME option. PackageMaterialConfiguration forces plugin author to implement following methods.
        </p>

<ul>
<li>
<p>
<strong>getRepositoryConfiguration:</strong>
 This method should return the repository level configuration that is needed to be captured while configuring a package material in Go. The configuration information should be
                   returned as an instance of RepositoryConfiguration.
                </p>

<pre class = 'code'>
    public RepositoryConfiguration getRepositoryConfiguration() {
        RepositoryConfiguration repositoryConfiguration = new RepositoryConfiguration();
        repositoryConfiguration.add(new Property("REPO_URL").with(Property.DISPLAY_NAME, "Repository Url").with(Property.DISPLAY_ORDER, 0));
        repositoryConfiguration.add(new Property("USERNAME").with(Property.DISPLAY_NAME, "Username").with(Property.DISPLAY_ORDER, 1));
        repositoryConfiguration.add(new Property("PASSWORD").with(Property.DISPLAY_NAME, "Password").with(Property.DISPLAY_ORDER, 2));
        return repositoryConfiguration;
    }
                </pre>
</li>

<li>
<p>
<strong>getPackageConfiguration:</strong>
 This method should return the package configuration that is needed to be captured while configuring a package material in Go. The configuration information should be returned
                   as an instance of PackageConfiguration.
                </p>

<pre class = 'code'>
    public PackageConfiguration getPackageConfiguration() {
        PackageConfiguration packageConfiguration = new PackageConfiguration();
        packageConfiguration.add(new Property("PACKAGE_DETAILS"));
        return packageConfiguration;
    }
                </pre>
</li>

<li>
<p>
<strong>isRepositoryConfigurationValid:</strong>
 This is a callback from Go to validate the user configured repository configuration. If ValidationResult contains one or more errors, these would be reported
                    by Go.
                </p>

<pre class = 'code'>
    public ValidationResult isRepositoryConfigurationValid(RepositoryConfiguration repositoryConfiguration) {
        ValidationResult validationResult = new ValidationResult();
        Property url = repositoryConfiguration.get("REPO_URL");
        if ( the configuration is invalid) {
            validationResult.addError(new ValidationError(validation error message));
        }
        return validationResult;
    }
                </pre>
</li>

<li>
<p>
<strong>isPackageConfigurationValid:</strong>
 This is a callback from Go to validate the user configured package configuration. If ValidationResult contains one or more errors, these would be reported by Go.
                    Both package and repository configuration is provided to this method so that any validations which should be performed across these configurations can be performed here.
                </p>

<pre class = 'code'>
    public ValidationResult isPackageConfigurationValid(PackageConfiguration packageConfiguration, RepositoryConfiguration repositoryConfiguration) {
        ValidationResult validationResult = new ValidationResult();
        if ( the configuration is invalid ) {
            validationResult.addError(new ValidationError(validation error message));
        }
        return validationResult;
    }
                </pre>
</li>
</ul>
</div>
</div>

<div class = 'section'>
<h3 onclick = 'toggleCollapse($(this));' class = 'collapsible-heading'>Repository Poller</h3>

<div class = 'content-container'>
<p> Periodically, Go checks all the configured materials for new updates. For a package material, it would invoke the corresponding repository poller implemented by the plugin.
            Repository poller should implement PackageMaterialPoller interface. Repository poller is responsible for fetching latest available version of the package based on the package and repository configuration.
            Repository poller is also invoked by Go to check connection to package and repository. PackageMaterialPoller forces plugin author to implement following methods.
        </p>

<ul>
<li>
<p>
<strong>getLatestRevision:</strong>
 This method is invoked when a new package material is introduced in Go. It should return the latest version of the package for given package and repository configuration.
                    Package version details are returned as an instance of PackageRevision. <a href = 'resources/javadoc/com/thoughtworks/go/plugin/api/material/packagerepository/PackageRevision.html' target = 'resources/javadoc/com/thoughtworks/go/plugin/api/material/packagerepository/PackageRevision.html'>Package Revision</a>
                    has information like revision, timestamp of the package, user who is responsible for generating this package, comment and trackbackUrl (this url can point to CI system which generated this package).
                </p>

<pre class = 'code'>
    public PackageRevision getLatestRevision(PackageConfiguration packageConfiguration, RepositoryConfiguration repositoryConfiguration) {
        latestPackageDetails = fetchLatestPackageDetailsFor(packageConfiguration, repositoryConfiguration);
        return new PackageRevision(latestPackageDetails.revision, latestPackageDetails.timestamp, latestPackageDetails.user, latestPackageDetails.comment, latestPackageDetails.trackbackUrl);
    }
                </pre>
</li>

<li>
<p>
<strong>latestModificationSince:</strong>

                    On subsequent material updates, Go would invoke this method with the last known revision for the package.
                    This method should return a version of the package which is later than the one known by Go.</p>

<pre class = 'code'>
    public PackageRevision latestModificationSince(PackageConfiguration packageConfiguration, RepositoryConfiguration repositoryConfiguration, PackageRevision previouslyKnownRevision) {
        latestPackageDetails = fetchLatestPackageDetailsFor(packageConfiguration, repositoryConfiguration);
        if (latestPackageDetails is later than previouslyKnownRevision)
            return new PackageRevision(latestPackageDetails.revision, latestPackageDetails.timestamp, latestPackageDetails.user, latestPackageDetails.comment, latestPackageDetails.trackbackUrl);
        else
            return null;
    }
                </pre>
</li>

<li>
<p>
<strong>checkConnectionToRepository:</strong>
 This method is expected to check if connection can be established for given repository configuration.</p>

<pre class = 'code'>
    public Result checkConnectionToRepository(RepositoryConfiguration repositoryConfiguration) {
        if (connectionCanBeEstablishedFor(repositoryConfiguration)) {
            return new Result().withSuccessMessages("Successfully accessed repository");
        } else {
            return new Result().withErrorMessages("Could not establish connection to repository");
        }
    }
                </pre>
</li>

<li>
<p>
<strong>checkConnectionToPackage:</strong>
 This method is expected to check if connection can be established for given package and repository configuration.</p>

<pre class = 'code'>
    public Result checkConnectionToRepository(PackageConfiguration packageConfiguration, RepositoryConfiguration repositoryConfiguration) {
        if (connectionCanBeEstablishedFor(packageConfiguration, repositoryConfiguration)) {
            return new Result().withSuccessMessages(Successfully accessed package);
        } else {
            return new Result().withErrorMessages("Could not establish connection to package");
        }
    }
                </pre>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div id = 'no_result_message' class = 'error-box' style = 'display:none;'>
<div class = 'box-content'>
<div class = 'box'>Your search 
<span class = 'search_term'></span>
did not match any help pages.</div>
</div>
</div>

<div id = 'nav'>
<ul class = 'toc'>
<li>
<a href = 'welcome_to_go.html' class = 'current'>Welcome to Go</a>

<ul>
<li>
<a href = 'whats_new_in_go.html'>What's new in Go</a>
</li>

<li>
<a href = 'concepts_in_go.html'>Concepts in Go</a>
</li>
</ul>
</li>

<li>
<div>Installing Go</div>

<ul>
<li>
<a href = 'system_requirements.html'>System requirements</a>
</li>

<li>
<a href = 'installing_go_server.html'>Installing Go server</a>
</li>

<li>
<a href = 'installing_go_agent.html'>Installing Go agent</a>
</li>

<li>
<a href = 'run_go_without_install.html'>Running Go without installation</a>
</li>

<li>
<a href = 'upgrading_go.html'>Upgrading Go</a>
</li>

<li>
<a href = 'configuring_server_details.html'>Configuring server details</a>
</li>

<li>
<a href = 'configure_proxy.html'>Configure a Proxy</a>
</li>

<li>
<a href = 'performance_tuning.html'>Performance Tuning</a>
</li>
</ul>
</li>

<li>
<div>Using Go</div>

<ul>
<li>
<a href = 'quick_pipeline_setup.html'>Setup a new pipeline</a>
</li>

<li>
<a href = 'managing_pipelines.html'>Managing pipelines</a>
</li>

<li>
<a href = 'managing_a_build_cloud.html'>Managing agents</a>
</li>

<li>
<a href = 'managing_artifacts_and_reports.html'>Managing artifacts and reports</a>
</li>

<li>
<a href = 'managing_dependencies.html'>Managing dependencies</a>
</li>

<li>
<a href = 'managing_environments.html'>Managing environments</a>
</li>

<li>
<a href = 'dev_authentication.html'>Setting up authentication</a>
</li>

<li>
<a href = 'managing_users.html'>Managing Users</a>
</li>

<li>
<a href = 'dev_notifications.html'>Notifications</a>
</li>

<li>
<a href = 'properties.html'>Properties</a>
</li>

<li>
<a href = 'build_labelling.html'>Pipeline Labelling</a>
</li>

<li>
<a href = 'compare_pipelines.html'>Compare Builds</a>
</li>

<li>
<a href = 'go_integration.html'>Integration with external tools</a>
</li>

<li>
<a href = 'ordering_of_pipelines.html'>Ordering of pipelines</a>
</li>

<li>
<a href = 'pipeline_scheduling.html'>Pipeline Scheduling</a>
</li>

<li>
<a href = 'gadgets.html'>Gadgets</a>
</li>

<li>
<a href = 'delete_artifacts.html'>Auto delete artifacts</a>
</li>

<li>
<a href = 'job_timeout.html'>Job Timeout</a>
</li>

<li>
<a href = 'stage_duration_chart.html'>Graphs</a>
</li>

<li>
<a href = 'stage_old_config.html'>Historical Configuration</a>
</li>

<li>
<a href = 'command_repository.html'>Command Repository</a>
</li>

<li>
<a href = 'concurrent_config_modifications.html'>Concurrent Modifications to Go's Configuration</a>
</li>

<li>
<a href = 'package_material.html'>Package Material</a>
</li>

<li>
<a href = 'plugin_user_guide.html'>Plugin User Guide</a>
</li>
</ul>
</li>

<li>
<div>Go Tour</div>

<ul>
<li>
<a href = 'Pipelines_Dashboard_page.html'>Pipelines Dashboard</a>
</li>

<li>
<a href = 'agents_page.html'>Agents</a>
</li>

<li>
<a href = 'pipeline_activity_page.html'>Pipeline Activity</a>
</li>

<li>
<a href = 'stage_details_page.html'>Stage Details</a>
</li>

<li>
<a href = 'job_details_page.html'>Job Details</a>
</li>

<li>
<a href = 'administration_page.html'>Administration</a>
</li>

<li>
<a href = 'server_details_page.html'>Server Details</a>
</li>

<li>
<a href = 'environments_page.html'>Environments</a>
</li>

<li>
<a href = 'value_stream_map.html'>Value Stream Map</a>
</li>
</ul>
</li>

<li>
<div>As a Developer, I want to...</div>

<ul>
<li>
<a href = 'Pipelines_Dashboard_page.html'>...watch what's currently building</a>
</li>

<li>
<a href = 'trigger_with_options.html'>...trigger a pipeline with a different revision of material</a>
</li>

<li>
<a href = 'dev_notifications.html'>...be notified when I break the build</a>
</li>

<li>
<a href = 'dev_understand_why_build_broken.html'>...understand why the build is broken</a>
</li>

<li>
<a href = 'dev_see_artifact_as_tab.html'>...see my artifacts as a sub-tab on the Job Details page</a>
</li>

<li>
<a href = 'dev_save_properties.html'>...save properties about a build</a>
</li>

<li>
<a href = 'dev_clean_up_when_cancel.html'>...clean up my environment when I cancel a task</a>
</li>

<li>
<a href = 'dev_conditional_task_execution.html'>...only run a task when the build has failed</a>
</li>

<li>
<a href = 'dev_use_current_revision_in_build.html#current'>...use the current revision in my build</a>
</li>
</ul>
</li>

<li>
<div>As a Tester, I want to...</div>

<ul>
<li>
<a href = 'rm_deploy_to_environment.html#deploy_uat'>...release something into my UAT environment</a>
</li>

<li>
<a href = 'tester_what_has_changed.html'>...know what has changed in my new binary</a>
</li>

<li>
<a href = 'dependency_management.html'>...ensure appropriate tests are run against new builds</a>
</li>
</ul>
</li>

<li>
<div>As a Release Manager, I want to...</div>

<ul>
<li>
<a href = 'rm_deploy_to_environment.html#deploy_prod'>...release something into production</a>
</li>

<li>
<a href = 'rm_what_is_deployed.html'>...know what's currently in production</a>
</li>

<li>
<a href = 'deploy_a_specific_build_to_an_environment.html'>...deploy a specific build to production</a>
</li>

<li>
<a href = 'managing_environments.html'>...manage my environments</a>
</li>
</ul>
</li>

<li>
<div>As a Go Administrator, I want to...</div>

<ul>
<li>
<a href = 'pipeline_templates.html'>...template my pipelines</a>
</li>

<li>
<a href = 'admin_use_parameters_in_configuration.html'>...parameterize my pipelines</a>
</li>

<li>
<a href = 'installing_go_agent.html'>...install a new agent</a>
</li>

<li>
<a href = 'agent_auto_register.html'>...auto register a remote agent</a>
</li>

<li>
<a href = 'agent_guid_issue.html'>...clone/copy existing agents</a>
</li>

<li>
<a href = 'admin_install_multiple_agents.html'>...install multiple agents on one machine</a>
</li>

<li>
<a href = 'agents_page.html#filter_agents'>...view and filter agents</a>
</li>

<li>
<a href = 'quick_pipeline_setup.html'>...add a new pipeline</a>
</li>

<li>
<a href = 'admin_add_material.html'>...add a new  material to an existing pipeline</a>
</li>

<li>
<a href = 'admin_add_stage.html'>...add a new stage to an existing pipeline</a>
</li>

<li>
<a href = 'admin_add_job.html'>...add a new job to an existing stage</a>
</li>

<li>
<a href = 'admin_run_on_all_agents.html'>...run the same job on a group of agents</a>
</li>

<li>
<a href = 'dev_use_current_revision_in_build.html#job'>...pass environment variables to jobs</a>
</li>

<li>
<a href = 'admin_lock_pipelines.html'>...ensure only one instance of a pipeline can run at the same time</a>
</li>

<li>
<a href = 'dev_choose_when_stage_runs.html'>...choose when a certain stage runs</a>
</li>

<li>
<a href = 'admin_use_custom_pipeline_label.html'>...use a custom pipeline label</a>
</li>

<li>
<a href = 'managing_dependencies.html'>...manage my dependent pipelines</a>
</li>

<li>
<a href = 'dev_authentication.html'>...enable authentication on my Go server</a>
</li>

<li>
<a href = 'dev_authentication.html#ldap_authentication'>..configure LDAP access for my Go server</a>
</li>

<li>
<a href = 'dev_authorization.html'>...change permissions for different actions</a>
</li>

<li>
<a href = 'dev_authorization.html#pipeline-groups'>...ensure only certain users can see a group of pipelines</a>
</li>

<li>
<a href = 'dev_upload_test_report.html'>...publish reports and artifacts</a>
</li>

<li>
<a href = 'ui_testing.html'>...configure an agent to run UI tests</a>
</li>

<li>
<a href = 'admin_mailhost_info.html'>...add mailhost information to support email notifications</a>
</li>

<li>
<a href = 'admin_out_of_disk_space.html'>...clean up old artifacts when running out of disk space</a>
</li>

<li>
<a href = 'admin_timer.html'>...run a pipeline on a schedule</a>
</li>

<li>
<a href = 'managing_a_build_cloud.html#pausing_agent'>...pause an agent</a>
</li>

<li>
<a href = 'agent_details.html#identifying_environment_issues'>...see if a job fails because of an environment issue</a>
</li>

<li>
<a href = 'delegating_group_administration.html'>...delegating group administration</a>
</li>

<li>
<a href = 'one_click_backup.html'>...backup Go server</a>
</li>

<li>
<a href = 'material_update_hung.html'>...be notified when Go server is not able to poll for changes</a>
</li>
</ul>
</li>

<li>
<div>Mingle Integration</div>

<ul>
<li>
<a href = 'mingle_in_go.html'>Displaying Mingle gadgets in Go</a>
</li>

<li>
<a href = 'mingle_card_activity_gadget.html'>Mingle Card Activity Gadget</a>
</li>
</ul>
</li>

<li>
<a href = 'http://support.thoughtworks.com/categories/20002778-go-community-support'>FAQ/Troubleshooting</a>
</li>

<li>
<a href = 'go_api.html'>Go API</a>

<ul>
<li>
<a href = 'Artifacts_API.html'>Artifacts API</a>
</li>

<li>
<a href = 'Properties_API.html'>Properties API</a>
</li>

<li>
<a href = 'Configuration_API.html'>Configuration API</a>
</li>

<li>
<a href = 'Pipeline_API.html'>Pipeline API</a>
</li>

<li>
<a href = 'Stages_API.html'>Stages API</a>
</li>

<li>
<a href = 'command_repo_api.html'>Command Repo API</a>
</li>

<li>
<a href = 'Agent_API.html'>Agent API</a>
</li>

<li>
<a href = 'Feeds_API.html'>Feeds API</a>
</li>

<li>
<a href = 'Backup_API.html'>Backup API</a>
</li>

<li>
<a href = 'materials_api.html'>Materials API</a>
</li>

<li>
<a href = 'users_api.html'>Users API</a>
</li>
</ul>
</li>

<li>
<div>Extension Points of Go</div>

<ul>
<li>
<a href = 'go_plugins_basics.html'>Plugins in Go</a>
</li>

<li>
<a href = 'resources/javadoc/index.html' target = '_blank'>Go Plugin API</a>
</li>

<li>
<a href = 'writing_go_package_material_plugin.html'>Writing a package material plugin</a>
</li>
</ul>
</li>

<li>
<div>Bundled Plugins</div>

<ul>
<li>
<a href = 'yum_repository_poller.html'>Yum Repository Poller</a>
</li>
</ul>
</li>

<li>
<div>Configuration</div>

<ul>
<li>
<a href = 'configuration_reference.html'>Configuration Reference</a>
</li>

<li>
<a href = 'schema.html'>Schema</a>
</li>
</ul>
</li>
</ul>
</div>

<div id = 'ft' class = 'footer'>&copy; ThoughtWorks Studios, 2010</div>
</body>
</html>
